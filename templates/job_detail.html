{% extends "base.html" %}
{% block title %}{{ job.title }} | Job Details{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 800px;">
  <h2 class="text-primary">{{ job.title }}</h2>
  <h5 class="text-muted">{{ job.company_name }}</h5>
  <p><strong>Employer:</strong> {{ job.employer_name }}</p>
  <p><strong>Posted On:</strong> {{ job.created_at.strftime('%B %d, %Y') if job.created_at else '' }}</p>

  <hr>
  <h4>Description</h4>
  <p>{{ job.description }}</p>

  <h4>Requirements</h4>
  <p>{{ job.requirements }}</p>

  {% if job.why_work_with_us %}
  <h4>Why Work With Us</h4>
  <p>{{ job.why_work_with_us }}</p>
  {% endif %}

  {% if job.mission %}
  <h4>Our Mission</h4>
  <p>{{ job.mission }}</p>
  {% endif %}

  {% if job.vision %}
  <h4>Our Vision</h4>
  <p>{{ job.vision }}</p>
  {% endif %}

  <hr>

  {% if session.get('role') == 'candidate' %}
    <h4 class="mt-4 mb-3 text-primary">Apply for this Job</h4>

    <form action="{{ url_for('apply', job_id=job.id) }}" method="POST" enctype="multipart/form-data" novalidate>
      <div class="mb-3">
        <label for="cv_file" class="form-label fw-semibold">Upload CV/Resume (PDF, max 5MB)</label>
        <input type="file" id="cv_file" name="cv_file" class="form-control" accept=".pdf" required>
        <div class="form-text text-muted">Accepted format: PDF only. Max size: 5MB.</div>
      </div>

      <div class="mb-3">
        <label for="cover_letter" class="form-label fw-semibold">Cover Letter</label>
        <textarea id="cover_letter" name="cover_letter" rows="4" class="form-control" placeholder="Write your cover letter..." required></textarea>
      </div>

      <div class="d-flex justify-content-between mt-4">
        <button type="submit" class="btn btn-success px-4">Submit Application</button>
        <a href="{{ url_for('jobs') }}" class="btn btn-secondary px-4">Back to Jobs</a>
      </div>
    </form>

    <script>
      document.querySelector('form').addEventListener('submit', function(event) {
        const cv = document.getElementById('cv_file').files[0];
        const maxSize = 5 * 1024 * 1024; // 5MB
        if (cv && cv.size > maxSize) {
          event.preventDefault();
          alert("CV file too large! Please upload a file less than 5MB.");
        }
      });
    </script>

  {% else %}
    <p class="text-muted mt-3">
      You must be logged in as a <strong>candidate</strong> to apply for this job.
    </p>
    <a href="{{ url_for('login') }}" class="btn btn-primary mt-2">Login Now</a>
  {% endif %}
</div>
{% endblock %}
